<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кликер-Эволюция | Масштабный кликер</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #1a252f;
            --background: #f5f7fa;
            --card-bg: #ffffff;
            --text: #333333;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Шапка */
        header {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 2rem;
            color: var(--secondary);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-level {
            background-color: var(--secondary);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .main-currency {
            background-color: var(--success);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        /* Основной контент */
        .game-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-top: 20px;
        }

        /* Основная игровая панель */
        .main-game {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 500px;
        }

        .clicker-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .click-button {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            border: none;
            border-radius: 50%;
            width: 250px;
            height: 250px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .click-button:hover {
            transform: scale(1.05);
        }

        .click-button:active {
            transform: scale(0.95);
        }

        .click-button i {
            font-size: 5rem;
            color: white;
        }

        .click-stats {
            display: flex;
            gap: 20px;
            text-align: center;
        }

        .stat {
            background-color: var(--light);
            padding: 10px 20px;
            border-radius: 10px;
            min-width: 150px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
        }

        /* Боковая панель с вкладками */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .tabs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tab-button {
            background-color: var(--card-bg);
            border: none;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 3px 10px var(--shadow);
        }

        .tab-button:hover {
            background-color: var(--secondary);
            color: white;
            transform: translateX(5px);
        }

        .tab-button.active {
            background-color: var(--primary);
            color: white;
        }

        .tab-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px var(--shadow);
            display: none;
            max-height: 600px;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        /* Контент вкладок */
        .upgrades-grid, .items-grid, .research-tree {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .upgrade-card, .item-card, .research-node {
            background-color: var(--light);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
            border-left: 5px solid var(--secondary);
        }

        .upgrade-card:hover, .item-card:hover, .research-node:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .upgrade-header, .item-header, .research-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .upgrade-title, .item-title, .research-title {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .upgrade-price, .item-price {
            color: var(--success);
            font-weight: bold;
        }

        .upgrade-description, .item-description, .research-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .buy-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
        }

        .buy-button:hover:not(:disabled) {
            background-color: var(--primary);
        }

        .buy-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Дерево исследований */
        .research-tree {
            grid-template-columns: 1fr;
        }

        .research-node {
            position: relative;
            margin-bottom: 20px;
        }

        .research-node.unlocked {
            border-left-color: var(--success);
        }

        .research-node.locked {
            border-left-color: #ccc;
            opacity: 0.7;
        }

        .research-requirements {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        /* Настройки и авторизация */
        .settings-container, .auth-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--light);
            border-radius: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: bold;
        }

        .form-group input {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        .auth-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .auth-button:hover {
            background-color: var(--primary);
        }

        .auth-switch {
            text-align: center;
            margin-top: 10px;
            color: var(--secondary);
            cursor: pointer;
            font-weight: bold;
        }

        /* Прогресс игры */
        .progress-container {
            margin-top: 30px;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 20px;
            background-color: var(--light);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }

        /* Уведомления */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        .notification.show {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Адаптивность */
        @media (max-width: 1100px) {
            .game-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
            
            .tabs {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .tab-button {
                flex: 1;
                min-width: 150px;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .click-stats {
                flex-direction: column;
                align-items: center;
            }
            
            .upgrades-grid, .items-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Анимации */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        /* Индикатор времени игры */
        .time-played {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-rocket"></i>
                <h1>Кликер-Эволюция</h1>
            </div>
            <div class="user-info">
                <div class="user-level">
                    <i class="fas fa-chart-line"></i> Уровень: <span id="level">1</span>
                </div>
                <div class="main-currency">
                    <i class="fas fa-coins"></i> <span id="coins">0</span>
                </div>
                <button id="logout-btn" class="auth-button" style="display: none; padding: 8px 15px;">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </button>
            </div>
        </div>
    </header>

    <!-- Основной контейнер -->
    <div class="container">
        <div class="game-container">
            <!-- Основная игровая панель -->
            <div class="main-game">
                <div class="clicker-area">
                    <h2>Кликер энергии</h2>
                    <p>Кликайте на центральную кнопку для генерации энергии</p>
                    <button class="click-button" id="click-button">
                        <i class="fas fa-bolt"></i>
                    </button>
                    <div class="click-stats">
                        <div class="stat">
                            <div class="stat-value" id="click-power">1</div>
                            <div>Сила клика</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="energy-per-second">0</div>
                            <div>Энергии/сек</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="total-clicks">0</div>
                            <div>Всего кликов</div>
                        </div>
                    </div>
                </div>
                
                <!-- Прогресс игры -->
                <div class="progress-container">
                    <div class="progress-header">
                        <h3>Прогресс игры</h3>
                        <span id="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">Начало пути к эволюции</div>
                </div>
                
                <!-- Время игры -->
                <div class="time-played">
                    <i class="fas fa-clock"></i> Время в игре: <span id="play-time">00:00:00</span>
                </div>
            </div>

            <!-- Боковая панель с вкладками -->
            <div class="sidebar">
                <!-- Кнопки вкладок -->
                <div class="tabs">
                    <button class="tab-button active" data-tab="upgrades">
                        <i class="fas fa-arrow-up"></i> Улучшения
                    </button>
                    <button class="tab-button" data-tab="items">
                        <i class="fas fa-shopping-cart"></i> Магазин
                    </button>
                    <button class="tab-button" data-tab="research">
                        <i class="fas fa-flask"></i> Исследования
                    </button>
                    <button class="tab-button" data-tab="settings">
                        <i class="fas fa-cog"></i> Настройки
                    </button>
                    <button class="tab-button" data-tab="auth">
                        <i class="fas fa-user"></i> Аккаунт
                    </button>
                </div>

                <!-- Контент вкладок -->
                <div id="upgrades" class="tab-content active">
                    <h2>Улучшения кликера</h2>
                    <div class="upgrades-grid" id="upgrades-container">
                        <!-- Улучшения будут добавлены через JS -->
                    </div>
                </div>

                <div id="items" class="tab-content">
                    <h2>Магазин предметов</h2>
                    <div class="items-grid" id="items-container">
                        <!-- Предметы будут добавлены через JS -->
                    </div>
                </div>

                <div id="research" class="tab-content">
                    <h2>Дерево исследований</h2>
                    <div class="research-tree" id="research-container">
                        <!-- Исследования будут добавлены через JS -->
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <h2>Настройки игры</h2>
                    <div class="settings-container">
                        <div class="setting-item">
                            <span>Звуковые эффекты</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sound-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Анимации</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="animation-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Темная тема</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="theme-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>Авто-кликер (разблокируется на 10 уровне)</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoclicker-toggle" disabled>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <button id="save-settings" class="auth-button">
                            <i class="fas fa-save"></i> Сохранить настройки
                        </button>
                        <button id="reset-game" class="auth-button" style="background-color: var(--accent);">
                            <i class="fas fa-redo"></i> Сбросить игру
                        </button>
                    </div>
                </div>

                <div id="auth" class="tab-content">
                    <h2 id="auth-title">Вход в аккаунт</h2>
                    <div class="auth-container">
                        <div class="auth-form">
                            <div class="form-group" id="username-group">
                                <label for="username">Имя пользователя</label>
                                <input type="text" id="username" placeholder="Введите имя пользователя">
                            </div>
                            <div class="form-group" id="email-group" style="display: none;">
                                <label for="email">Email</label>
                                <input type="email" id="email" placeholder="Введите email">
                            </div>
                            <div class="form-group">
                                <label for="password">Пароль</label>
                                <input type="password" id="password" placeholder="Введите пароль">
                            </div>
                            <button id="auth-submit" class="auth-button">Войти</button>
                        </div>
                        <div class="auth-switch" id="auth-switch">
                            Нет аккаунта? Зарегистрируйтесь
                        </div>
                        <div id="auth-info" style="display: none;">
                            <p>Вы вошли как: <span id="logged-user"></span></p>
                            <p>Уровень: <span id="logged-level"></span></p>
                            <p>Игра сохранена: <span id="last-save"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Уведомление -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Уведомление</span>
    </div>

    <script>
        // Игровые данные
        const gameData = {
            coins: 0,
            totalClicks: 0,
            clickPower: 1,
            energyPerSecond: 0,
            level: 1,
            experience: 0,
            experienceToNextLevel: 100,
            upgrades: [],
            items: [],
            researches: [],
            settings: {
                sound: true,
                animations: true,
                darkTheme: false,
                autoclicker: false
            },
            playTime: 0,
            isLoggedIn: false,
            username: '',
            lastSave: null
        };

        // Игровые объекты
        const upgradesData = [
            { id: 1, name: "Усиленный клик", description: "Увеличивает силу клика на 1", price: 10, effect: { clickPower: 1 }, maxLevel: 50 },
            { id: 2, name: "Двойной клик", description: "Шанс 10% на двойной клик", price: 50, effect: { doubleChance: 10 }, maxLevel: 20 },
            { id: 3, name: "Авто-кликер I", description: "Автоматически кликает 1 раз в секунду", price: 100, effect: { energyPerSecond: 1 }, maxLevel: 10 },
            { id: 4, name: "Авто-кликер II", description: "Автоматически кликает 5 раз в секунду", price: 500, effect: { energyPerSecond: 5 }, maxLevel: 5 },
            { id: 5, name: "Умный клик", description: "Увеличивает опыт за клик на 20%", price: 200, effect: { expBoost: 20 }, maxLevel: 10 },
            { id: 6, name: "Критический удар", description: "Шанс 5% на критический удар x5", price: 1000, effect: { criticalChance: 5 }, maxLevel: 10 }
        ];

        const itemsData = [
            { id: 1, name: "Энергетическая батарея", description: "Увеличивает генерацию энергии на 10%", price: 500, effect: { energyBoost: 10 }, type: "boost" },
            { id: 2, name: "Усилитель кликов", description: "Увеличивает силу клика на 5", price: 1000, effect: { clickPower: 5 }, type: "boost" },
            { id: 3, name: "Временной ускоритель", description: "Увеличивает скорость игры на 10% на 30 минут", price: 2000, effect: { timeBoost: 10 }, type: "consumable" },
            { id: 4, name: "Книга знаний", description: "Увеличивает получаемый опыт на 25%", price: 3000, effect: { expBoost: 25 }, type: "boost" },
            { id: 5, name: "Легендарный кликер", description: "Увеличивает все показатели на 15%", price: 10000, effect: { allBoost: 15 }, type: "boost" },
            { id: 6, name: "Артефакт времени", description: "Замедляет время в игре, увеличивая ваш КПД", price: 15000, effect: { timeSlow: 20 }, type: "boost" }
        ];

        const researchesData = [
            { id: 1, name: "Основы кликерологии", description: "Открывает базовые улучшения", price: 1000, requirements: [], effect: { unlockUpgrades: [1, 2] }, branch: "basic" },
            { id: 2, name: "Автоматизация", description: "Открывает авто-кликеры", price: 5000, requirements: [1], effect: { unlockUpgrades: [3, 4] }, branch: "basic" },
            { id: 3, name: "Энергетика", description: "Увеличивает эффективность энергии на 20%", price: 10000, requirements: [1], effect: { energyEfficiency: 20 }, branch: "energy" },
            { id: 4, name: "Квантовые клики", description: "Позволяет кликать в параллельных вселенных", price: 25000, requirements: [2, 3], effect: { parallelClicks: 1 }, branch: "advanced" },
            { id: 5, name: "Темная материя", description: "Открывает доступ к темной энергии", price: 50000, requirements: [4], effect: { darkEnergy: 10 }, branch: "advanced" },
            { id: 6, name: "Сингулярность", description: "Достижение максимальной эволюции кликера", price: 100000, requirements: [5], effect: { singularity: true }, branch: "ultimate" }
        ];

        // DOM элементы
        const coinsElement = document.getElementById('coins');
        const clickPowerElement = document.getElementById('click-power');
        const energyPerSecondElement = document.getElementById('energy-per-second');
        const totalClicksElement = document.getElementById('total-clicks');
        const levelElement = document.getElementById('level');
        const clickButton = document.getElementById('click-button');
        const upgradesContainer = document.getElementById('upgrades-container');
        const itemsContainer = document.getElementById('items-container');
        const researchContainer = document.getElementById('research-container');
        const progressFill = document.getElementById('progress-fill');
        const progressPercent = document.getElementById('progress-percent');
        const progressText = document.getElementById('progress-text');
        const playTimeElement = document.getElementById('play-time');
        const logoutButton = document.getElementById('logout-btn');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');

        // Система вкладок
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Скрыть все вкладки
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                // Убрать активный класс со всех кнопок
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Показать выбранную вкладку
                document.getElementById(tabId).classList.add('active');
                button.classList.add('active');
            });
        });

        // Система авторизации
        const authTitle = document.getElementById('auth-title');
        const authSubmit = document.getElementById('auth-submit');
        const authSwitch = document.getElementById('auth-switch');
        const usernameGroup = document.getElementById('username-group');
        const emailGroup = document.getElementById('email-group');
        const authInfo = document.getElementById('auth-info');
        const loggedUser = document.getElementById('logged-user');
        const loggedLevel = document.getElementById('logged-level');
        const lastSave = document.getElementById('last-save');
        let isRegistering = false;

        authSwitch.addEventListener('click', () => {
            isRegistering = !isRegistering;
            
            if (isRegistering) {
                authTitle.textContent = 'Регистрация аккаунта';
                authSubmit.textContent = 'Зарегистрироваться';
                authSwitch.textContent = 'Уже есть аккаунт? Войдите';
                emailGroup.style.display = 'flex';
            } else {
                authTitle.textContent = 'Вход в аккаунт';
                authSubmit.textContent = 'Войти';
                authSwitch.textContent = 'Нет аккаунта? Зарегистрируйтесь';
                emailGroup.style.display = 'none';
            }
        });

        authSubmit.addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value;
            
            if (!username || !password) {
                showNotification('Введите имя пользователя и пароль', 'warning');
                return;
            }
            
            if (isRegistering && !email) {
                showNotification('Введите email для регистрации', 'warning');
                return;
            }
            
            if (isRegistering) {
                // Регистрация
                if (localStorage.getItem(`clicker_user_${username}`)) {
                    showNotification('Пользователь с таким именем уже существует', 'error');
                    return;
                }
                
                const userData = {
                    username,
                    email,
                    password, // В реальном приложении нужно хэшировать пароль
                    gameData: { ...gameData, username },
                    registered: new Date().toISOString()
                };
                
                localStorage.setItem(`clicker_user_${username}`, JSON.stringify(userData));
                showNotification('Аккаунт успешно создан!', 'success');
                
                // Автоматический вход после регистрации
                loginUser(username);
            } else {
                // Вход
                const userData = localStorage.getItem(`clicker_user_${username}`);
                if (!userData) {
                    showNotification('Пользователь не найден', 'error');
                    return;
                }
                
                const parsedData = JSON.parse(userData);
                if (parsedData.password !== password) {
                    showNotification('Неверный пароль', 'error');
                    return;
                }
                
                loginUser(username);
            }
        });

        logoutButton.addEventListener('click', () => {
            if (confirm('Вы уверены, что хотите выйти? Игра будет сохранена.')) {
                saveGame();
                gameData.isLoggedIn = false;
                gameData.username = '';
                updateAuthUI();
                showNotification('Вы вышли из аккаунта', 'info');
            }
        });

        function loginUser(username) {
            const userData = JSON.parse(localStorage.getItem(`clicker_user_${username}`));
            
            // Загружаем данные пользователя
            Object.assign(gameData, userData.gameData);
            gameData.isLoggedIn = true;
            gameData.username = username;
            
            updateAuthUI();
            updateUI();
            loadUpgrades();
            loadItems();
            loadResearches();
            
            showNotification(`Добро пожаловать, ${username}!`, 'success');
        }

        function updateAuthUI() {
            if (gameData.isLoggedIn) {
                authInfo.style.display = 'block';
                loggedUser.textContent = gameData.username;
                loggedLevel.textContent = gameData.level;
                lastSave.textContent = gameData.lastSave ? new Date(gameData.lastSave).toLocaleString() : 'Никогда';
                logoutButton.style.display = 'block';
                
                // Скрываем форму авторизации
                document.querySelector('.auth-form').style.display = 'none';
                authSwitch.style.display = 'none';
            } else {
                authInfo.style.display = 'none';
                logoutButton.style.display = 'none';
                document.querySelector('.auth-form').style.display = 'flex';
                authSwitch.style.display = 'block';
            }
        }

        // Инициализация улучшений
        function loadUpgrades() {
            upgradesContainer.innerHTML = '';
            
            upgradesData.forEach(upgrade => {
                const owned = gameData.upgrades.find(u => u.id === upgrade.id) || { level: 0 };
                const card = document.createElement('div');
                card.className = 'upgrade-card';
                
                const canAfford = gameData.coins >= calculateUpgradePrice(upgrade.id, owned.level);
                const isMaxLevel = owned.level >= upgrade.maxLevel;
                
                card.innerHTML = `
                    <div class="upgrade-header">
                        <div class="upgrade-title">${upgrade.name} (${owned.level}/${upgrade.maxLevel})</div>
                        <div class="upgrade-price">${calculateUpgradePrice(upgrade.id, owned.level)}</div>
                    </div>
                    <div class="upgrade-description">${upgrade.description}</div>
                    <button class="buy-button" ${!canAfford || isMaxLevel ? 'disabled' : ''}>
                        ${isMaxLevel ? 'Макс. уровень' : (canAfford ? 'Купить' : 'Недостаточно энергии')}
                    </button>
                `;
                
                const buyButton = card.querySelector('.buy-button');
                if (!isMaxLevel) {
                    buyButton.addEventListener('click', () => {
                        buyUpgrade(upgrade.id);
                    });
                }
                
                upgradesContainer.appendChild(card);
            });
        }

        // Инициализация предметов
        function loadItems() {
            itemsContainer.innerHTML = '';
            
            itemsData.forEach(item => {
                const owned = gameData.items.find(i => i.id === item.id) || { owned: false };
                const card = document.createElement('div');
                card.className = 'item-card';
                
                const canAfford = gameData.coins >= item.price;
                
                card.innerHTML = `
                    <div class="item-header">
                        <div class="item-title">${item.name}</div>
                        <div class="item-price">${item.price}</div>
                    </div>
                    <div class="item-description">${item.description}</div>
                    <button class="buy-button" ${!canAfford ? 'disabled' : ''}>
                        ${owned.owned ? 'Куплено' : (canAfford ? 'Купить' : 'Недостаточно энергии')}
                    </button>
                `;
                
                const buyButton = card.querySelector('.buy-button');
                if (!owned.owned) {
                    buyButton.addEventListener('click', () => {
                        buyItem(item.id);
                    });
                }
                
                itemsContainer.appendChild(card);
            });
        }

        // Инициализация исследований
        function loadResearches() {
            researchContainer.innerHTML = '';
            
            researchesData.forEach(research => {
                const researched = gameData.researches.find(r => r.id === research.id) || { researched: false };
                const card = document.createElement('div');
                card.className = `research-node ${researched.researched ? 'unlocked' : 'locked'}`;
                
                const canAfford = gameData.coins >= research.price;
                const requirementsMet = research.requirements.every(reqId => 
                    gameData.researches.find(r => r.id === reqId && r.researched)
                );
                
                card.innerHTML = `
                    <div class="research-header">
                        <div class="research-title">${research.name}</div>
                        <div class="upgrade-price">${research.price}</div>
                    </div>
                    <div class="research-description">${research.description}</div>
                    <div class="research-requirements">
                        Требования: ${research.requirements.length > 0 ? 
                            research.requirements.map(r => researchesData.find(rd => rd.id === r).name).join(', ') : 
                            'Нет'}
                    </div>
                    <button class="buy-button" ${!canAfford || !requirementsMet || researched.researched ? 'disabled' : ''}>
                        ${researched.researched ? 'Исследовано' : 
                         (!requirementsMet ? 'Требования не выполнены' : 
                         (canAfford ? 'Исследовать' : 'Недостаточно энергии'))}
                    </button>
                `;
                
                const buyButton = card.querySelector('.buy-button');
                if (!researched.researched && requirementsMet) {
                    buyButton.addEventListener('click', () => {
                        buyResearch(research.id);
                    });
                }
                
                researchContainer.appendChild(card);
            });
        }

        // Покупка улучшения
        function buyUpgrade(upgradeId) {
            const upgrade = upgradesData.find(u => u.id === upgradeId);
            const owned = gameData.upgrades.find(u => u.id === upgradeId) || { id: upgradeId, level: 0 };
            
            const price = calculateUpgradePrice(upgradeId, owned.level);
            
            if (gameData.coins >= price && owned.level < upgrade.maxLevel) {
                gameData.coins -= price;
                owned.level++;
                
                if (!gameData.upgrades.find(u => u.id === upgradeId)) {
                    gameData.upgrades.push(owned);
                }
                
                // Применяем эффект улучшения
                applyUpgradeEffect(upgrade, owned.level);
                
                updateUI();
                loadUpgrades();
                showNotification(`Улучшение "${upgrade.name}" куплено!`, 'success');
                
                // Сохраняем игру
                saveGame();
            }
        }

        // Покупка предмета
        function buyItem(itemId) {
            const item = itemsData.find(i => i.id === itemId);
            const owned = gameData.items.find(i => i.id === itemId);
            
            if (owned) {
                showNotification('Этот предмет уже куплен', 'warning');
                return;
            }
            
            if (gameData.coins >= item.price) {
                gameData.coins -= item.price;
                gameData.items.push({ id: itemId, owned: true });
                
                // Применяем эффект предмета
                applyItemEffect(item);
                
                updateUI();
                loadItems();
                showNotification(`Предмет "${item.name}" куплен!`, 'success');
                
                // Сохраняем игру
                saveGame();
            }
        }

        // Покупка исследования
        function buyResearch(researchId) {
            const research = researchesData.find(r => r.id === researchId);
            const researched = gameData.researches.find(r => r.id === researchId);
            
            if (researched) {
                showNotification('Это исследование уже выполнено', 'warning');
                return;
            }
            
            // Проверяем требования
            const requirementsMet = research.requirements.every(reqId => 
                gameData.researches.find(r => r.id === reqId && r.researched)
            );
            
            if (!requirementsMet) {
                showNotification('Не выполнены требования для исследования', 'warning');
                return;
            }
            
            if (gameData.coins >= research.price) {
                gameData.coins -= research.price;
                gameData.researches.push({ id: researchId, researched: true });
                
                // Применяем эффект исследования
                applyResearchEffect(research);
                
                updateUI();
                loadResearches();
                showNotification(`Исследование "${research.name}" завершено!`, 'success');
                
                // Сохраняем игру
                saveGame();
            }
        }

        // Применение эффекта улучшения
        function applyUpgradeEffect(upgrade, level) {
            if (upgrade.effect.clickPower) {
                gameData.clickPower += upgrade.effect.clickPower;
            }
            
            if (upgrade.effect.energyPerSecond) {
                gameData.energyPerSecond += upgrade.effect.energyPerSecond * level;
            }
            
            // Обновляем авто-кликер в настройках
            if (gameData.energyPerSecond > 0 && gameData.level >= 10) {
                document.getElementById('autoclicker-toggle').disabled = false;
            }
        }

        // Применение эффекта предмета
        function applyItemEffect(item) {
            if (item.effect.clickPower) {
                gameData.clickPower += item.effect.clickPower;
            }
            
            if (item.effect.energyBoost) {
                // Увеличиваем генерацию энергии на процент
                const boost = 1 + (item.effect.energyBoost / 100);
                gameData.energyPerSecond = Math.floor(gameData.energyPerSecond * boost);
            }
            
            if (item.effect.allBoost) {
                // Увеличиваем все показатели на процент
                const boost = 1 + (item.effect.allBoost / 100);
                gameData.clickPower = Math.floor(gameData.clickPower * boost);
                gameData.energyPerSecond = Math.floor(gameData.energyPerSecond * boost);
            }
        }

        // Применение эффекта исследования
        function applyResearchEffect(research) {
            if (research.effect.unlockUpgrades) {
                // Разблокируем улучшения
                research.effect.unlockUpgrades.forEach(upgradeId => {
                    const upgrade = upgradesData.find(u => u.id === upgradeId);
                    showNotification(`Разблокировано улучшение: ${upgrade.name}`, 'info');
                });
            }
            
            if (research.effect.energyEfficiency) {
                // Увеличиваем эффективность энергии
                const boost = 1 + (research.effect.energyEfficiency / 100);
                gameData.clickPower = Math.floor(gameData.clickPower * boost);
                gameData.energyPerSecond = Math.floor(gameData.energyPerSecond * boost);
            }
            
            if (research.effect.parallelClicks) {
                // Добавляем параллельные клики
                gameData.clickPower *= 2;
                showNotification('Теперь вы можете кликать в параллельных вселенных!', 'info');
            }
            
            if (research.effect.singularity) {
                // Достигнута сингулярность - максимальный буст
                gameData.clickPower *= 10;
                gameData.energyPerSecond *= 10;
                showNotification('Достигнута сингулярность! Вы на пике эволюции кликера!', 'success');
            }
        }

        // Расчет цены улучшения
        function calculateUpgradePrice(upgradeId, currentLevel) {
            const basePrice = upgradesData.find(u => u.id === upgradeId).price;
            return Math.floor(basePrice * Math.pow(1.5, currentLevel));
        }

        // Клик по основной кнопке
        clickButton.addEventListener('click', () => {
            gameData.coins += gameData.clickPower;
            gameData.totalClicks++;
            gameData.experience += Math.floor(gameData.clickPower / 2);
            
            // Проверяем уровень
            checkLevelUp();
            
            updateUI();
            
            // Анимация клика
            if (gameData.settings.animations) {
                clickButton.classList.add('pulse');
                setTimeout(() => {
                    clickButton.classList.remove('pulse');
                }, 300);
            }
            
            // Сохраняем игру каждые 10 кликов
            if (gameData.totalClicks % 10 === 0) {
                saveGame();
            }
        });

        // Проверка повышения уровня
        function checkLevelUp() {
            if (gameData.experience >= gameData.experienceToNextLevel) {
                gameData.level++;
                gameData.experience -= gameData.experienceToNextLevel;
                gameData.experienceToNextLevel = Math.floor(gameData.experienceToNextLevel * 1.5);
                
                showNotification(`Поздравляем! Вы достигли ${gameData.level} уровня!`, 'success');
                
                // Разблокируем авто-кликер на 10 уровне
                if (gameData.level >= 10 && gameData.energyPerSecond > 0) {
                    document.getElementById('autoclicker-toggle').disabled = false;
                    showNotification('Авто-кликер разблокирован! Включите его в настройках.', 'info');
                }
                
                updateUI();
            }
        }

        // Обновление интерфейса
        function updateUI() {
            coinsElement.textContent = formatNumber(gameData.coins);
            clickPowerElement.textContent = formatNumber(gameData.clickPower);
            energyPerSecondElement.textContent = formatNumber(gameData.energyPerSecond);
            totalClicksElement.textContent = formatNumber(gameData.totalClicks);
            levelElement.textContent = gameData.level;
            
            // Прогресс игры (рассчитываем на основе общего прогресса)
            const totalPossibleUpgrades = upgradesData.reduce((sum, u) => sum + u.maxLevel, 0);
            const totalOwnedUpgrades = gameData.upgrades.reduce((sum, u) => sum + u.level, 0);
            const upgradeProgress = totalOwnedUpgrades / totalPossibleUpgrades;
            
            const researchProgress = gameData.researches.length / researchesData.length;
            const itemProgress = gameData.items.length / itemsData.length;
            
            const totalProgress = (upgradeProgress * 0.4 + researchProgress * 0.4 + itemProgress * 0.2) * 100;
            
            progressFill.style.width = `${totalProgress}%`;
            progressPercent.textContent = `${Math.round(totalProgress)}%`;
            
            // Текст прогресса в зависимости от уровня
            if (gameData.level < 5) {
                progressText.textContent = 'Начало пути к эволюции';
            } else if (gameData.level < 15) {
                progressText.textContent = 'Освоение основ кликерологии';
            } else if (gameData.level < 30) {
                progressText.textContent = 'Продвинутый этап эволюции';
            } else if (gameData.level < 50) {
                progressText.textContent = 'Мастер кликерных технологий';
            } else if (gameData.level < 75) {
                progressText.textContent = 'Легенда кликерного мира';
            } else {
                progressText.textContent = 'Повелитель кликерной сингулярности';
            }
        }

        // Форматирование чисел
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Показать уведомление
        function showNotification(message, type = 'info') {
            notificationText.textContent = message;
            
            // Изменяем цвет в зависимости от типа
            if (type === 'success') {
                notification.style.backgroundColor = '#2ecc71';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#e74c3c';
            } else if (type === 'warning') {
                notification.style.backgroundColor = '#f39c12';
            } else {
                notification.style.backgroundColor = '#3498db';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Система сохранения
        function saveGame() {
            if (gameData.isLoggedIn) {
                gameData.lastSave = new Date().toISOString();
                
                const userData = JSON.parse(localStorage.getItem(`clicker_user_${gameData.username}`));
                userData.gameData = gameData;
                localStorage.setItem(`clicker_user_${gameData.username}`, JSON.stringify(userData));
                
                // Обновляем UI
                if (lastSave) {
                    lastSave.textContent = new Date(gameData.lastSave).toLocaleString();
                }
                
                console.log('Игра сохранена');
            }
        }

        // Авто-сохранение каждые 30 секунд
        setInterval(() => {
            if (gameData.isLoggedIn) {
                saveGame();
            }
        }, 30000);

        // Авто-кликер
        setInterval(() => {
            if (gameData.settings.autoclicker && gameData.energyPerSecond > 0) {
                gameData.coins += gameData.energyPerSecond;
                gameData.experience += Math.floor(gameData.energyPerSecond / 5);
                
                // Проверяем уровень
                checkLevelUp();
                
                updateUI();
            }
        }, 1000);

        // Таймер игры
        setInterval(() => {
            gameData.playTime++;
            
            const hours = Math.floor(gameData.playTime / 3600);
            const minutes = Math.floor((gameData.playTime % 3600) / 60);
            const seconds = gameData.playTime % 60;
            
            playTimeElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Сохранение каждые 5 минут
            if (gameData.playTime % 300 === 0) {
                saveGame();
            }
            
            // Проверяем достижение 116 часов
            if (gameData.playTime >= 116 * 3600) {
                showNotification('Поздравляем! Вы достигли 116 часов игры! Вы завершили основную цель!', 'success');
            }
        }, 1000);

        // Настройки
        const soundToggle = document.getElementById('sound-toggle');
        const animationToggle = document.getElementById('animation-toggle');
        const themeToggle = document.getElementById('theme-toggle');
        const autoclickerToggle = document.getElementById('autoclicker-toggle');
        const saveSettingsButton = document.getElementById('save-settings');
        const resetGameButton = document.getElementById('reset-game');

        // Загрузка настроек
        function loadSettings() {
            soundToggle.checked = gameData.settings.sound;
            animationToggle.checked = gameData.settings.animations;
            themeToggle.checked = gameData.settings.darkTheme;
            autoclickerToggle.checked = gameData.settings.autoclicker;
            
            // Применяем тему
            applyTheme();
        }

        // Сохранение настроек
        saveSettingsButton.addEventListener('click', () => {
            gameData.settings.sound = soundToggle.checked;
            gameData.settings.animations = animationToggle.checked;
            gameData.settings.darkTheme = themeToggle.checked;
            gameData.settings.autoclicker = autoclickerToggle.checked;
            
            // Применяем тему
            applyTheme();
            
            showNotification('Настройки сохранены', 'success');
            saveGame();
        });

        // Сброс игры
        resetGameButton.addEventListener('click', () => {
            if (confirm('Вы уверены, что хотите сбросить игру? Все ваши прогресс будет утерян.')) {
                // Сохраняем только настройки и данные аккаунта
                const settings = gameData.settings;
                const isLoggedIn = gameData.isLoggedIn;
                const username = gameData.username;
                
                // Сбрасываем игровые данные
                Object.assign(gameData, {
                    coins: 0,
                    totalClicks: 0,
                    clickPower: 1,
                    energyPerSecond: 0,
                    level: 1,
                    experience: 0,
                    experienceToNextLevel: 100,
                    upgrades: [],
                    items: [],
                    researches: [],
                    playTime: 0,
                    settings,
                    isLoggedIn,
                    username
                });
                
                updateUI();
                loadUpgrades();
                loadItems();
                loadResearches();
                
                showNotification('Игра сброшена', 'info');
                
                if (isLoggedIn) {
                    saveGame();
                }
            }
        });

        // Применение темы
        function applyTheme() {
            if (gameData.settings.darkTheme) {
                document.documentElement.style.setProperty('--primary', '#1a1a2e');
                document.documentElement.style.setProperty('--secondary', '#16213e');
                document.documentElement.style.setProperty('--background', '#0f3460');
                document.documentElement.style.setProperty('--card-bg', '#1a1a2e');
                document.documentElement.style.setProperty('--text', '#e6e6e6');
                document.documentElement.style.setProperty('--light', '#16213e');
            } else {
                document.documentElement.style.setProperty('--primary', '#2c3e50');
                document.documentElement.style.setProperty('--secondary', '#3498db');
                document.documentElement.style.setProperty('--background', '#f5f7fa');
                document.documentElement.style.setProperty('--card-bg', '#ffffff');
                document.documentElement.style.setProperty('--text', '#333333');
                document.documentElement.style.setProperty('--light', '#ecf0f1');
            }
        }

        // Авто-кликер переключатель
        autoclickerToggle.addEventListener('change', () => {
            if (gameData.level >= 10 && gameData.energyPerSecond > 0) {
                gameData.settings.autoclicker = autoclickerToggle.checked;
            } else {
                autoclickerToggle.checked = false;
                showNotification('Авто-кликер доступен с 10 уровня и при наличии улучшений', 'warning');
            }
        });

        // Загрузка игры при запуске
        window.addEventListener('load', () => {
            // Проверяем, есть ли сохраненная игра для гостя
            const savedGuestGame = localStorage.getItem('clicker_guest_game');
            if (savedGuestGame && !gameData.isLoggedIn) {
                if (confirm('Найдено сохранение для гостя. Загрузить?')) {
                    Object.assign(gameData, JSON.parse(savedGuestGame));
                    updateUI();
                    loadUpgrades();
                    loadItems();
                    loadResearches();
                    loadSettings();
                    showNotification('Гостевая игра загружена', 'success');
                }
            }
            
            // Загружаем настройки
            loadSettings();
            
            // Показываем приветственное сообщение
            setTimeout(() => {
                showNotification('Добро пожаловать в Кликер-Эволюцию! Начните кликать для генерации энергии.', 'info');
            }, 1000);
            
            // Авто-сохранение гостевой игры
            setInterval(() => {
                if (!gameData.isLoggedIn) {
                    localStorage.setItem('clicker_guest_game', JSON.stringify(gameData));
                }
            }, 60000);
        });

        // Предотвращение закрытия страницы без сохранения
        window.addEventListener('beforeunload', (e) => {
            if (gameData.isLoggedIn || gameData.totalClicks > 0) {
                saveGame();
                if (!gameData.isLoggedIn) {
                    localStorage.setItem('clicker_guest_game', JSON.stringify(gameData));
                }
                
                // Для старых браузеров
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Инициализация UI
        updateUI();
        loadUpgrades();
        loadItems();
        loadResearches();
        loadSettings();
        updateAuthUI();
    </script>
</body>
</html>